<!DOCTYPE html>
<html>
<head>
  <title>Spring Boot Chat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>

<body style="font-family: 'Courier New', monospace; margin: 0; background: linear-gradient(135deg, #0f0f0f, #1a0028); color: #fff;">

  <!-- Login -->
  <div id="loginDiv" 
       style="text-align:center; max-width: 420px; margin: 80px auto; padding: 25px; 
              background: rgba(20,20,30,0.9); border-radius:18px; 
              box-shadow: 0 0 20px #ff00ff, 0 0 40px #00ffff;">
    <h2 style="margin-bottom:25px; color:#ff00ff; text-shadow:0 0 10px #ff00ff;">⚡ Join the Grid ⚡</h2>
    
    <input type="text" id="username" placeholder="Your name" 
           style="width: 90%; padding: 12px; margin: 12px 0; border:1px solid #ff00ff; border-radius:8px; 
                  background:#111; color:#0ff; text-align:center; font-weight:bold; 
                  box-shadow:0 0 10px #ff00ff inset;">
    <br>
    <input type="text" id="room" placeholder="Room name" 
           style="width: 90%; padding: 12px; margin: 12px 0; border:1px solid #00ffff; border-radius:8px; 
                  background:#111; color:#ff0; text-align:center; font-weight:bold; 
                  box-shadow:0 0 10px #00ffff inset;">
    <br>
    <button onclick="joinRoom()" 
            style="padding:12px 25px; border:none; background:linear-gradient(90deg,#ff00ff,#00ffff); 
                   color:#fff; font-weight:bold; border-radius:25px; cursor:pointer; 
                   text-transform:uppercase; box-shadow:0 0 15px #ff00ff, 0 0 25px #00ffff;">Enter</button>
  </div>

  <!-- Chat -->
  <div id="chatDiv" 
       style="display:none; max-width: 700px; margin: 40px auto; padding:25px; 
              background: rgba(15,15,25,0.95); border-radius:12px; 
              box-shadow:0 0 25px #ff00ff, 0 0 40px #00ffff;">
    <h2 id="roomTitle" 
        style="margin-bottom:20px; color:#0ff; text-shadow:0 0 10px #0ff, 0 0 20px #ff0;">Room</h2>
    
    <div id="chat" 
         style="border:2px solid #ff00ff; height:320px; overflow-y:auto; padding:12px; margin-bottom:15px; 
                background:#0a0a0f; border-radius:15px; color:#fff; 
                box-shadow:inset 0 0 20px #ff00ff, inset 0 0 30px #00ffff;">
    </div>
    
    <input type="text" id="content" placeholder="Type your message..."
           style="width:70%; padding:12px; border:1px solid #00ffff; border-radius:12px; 
                  background:#111; color:#fff; font-weight:bold; 
                  box-shadow:0 0 10px #00ffff inset;">
    <button onclick="sendMessage()" 
            style="padding:12px 25px; margin-left:10px; border:none; 
                   background:linear-gradient(90deg,#0ff,#ff00ff); color:#000; 
                   font-weight:bold; border-radius:12px; cursor:pointer; 
                   text-transform:uppercase; 
                   box-shadow:0 0 15px #0ff, 0 0 25px #ff00ff;">Send</button>
  </div>

  <script>
    var stompClient = null;
    var currentUser = null;
    var currentRoom = null;

    function connect(callback) {
      var socket = new SockJS('/ws');
      stompClient = Stomp.over(socket);
      stompClient.connect({}, function(frame) {
        console.log("✅ Connected: " + frame);
        callback();
      }, function(error) {
        console.error("❌ WebSocket error: ", error);
        alert("Connection failed, check backend logs!");
      });
    }

    function joinRoom() {
      currentUser = document.getElementById("username").value.trim();
      currentRoom = document.getElementById("room").value.trim();

      if (!currentUser || !currentRoom) {
        alert("Enter both name and room!");
        return;
      }

      connect(function() {
        stompClient.subscribe('/topic/' + currentRoom, function(messageOutput) {
          showMessage(JSON.parse(messageOutput.body));
        });

        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("chatDiv").style.display = "block";
        document.getElementById("roomTitle").innerText = "⚔ Room: " + currentRoom + " ⚔";
      });
    }

    function sendMessage() {
      var content = document.getElementById("content").value;
      if (content.trim() !== "") {
        stompClient.send("/app/sendMessage/" + currentRoom, {}, JSON.stringify({
          'sender': currentUser,
          'content': content,
          'room': currentRoom
        }));
        document.getElementById("content").value = "";
      }
    }

    function showMessage(message) {
      var chat = document.getElementById("chat");
      chat.innerHTML += "<p style='margin:8px 0; padding:8px 12px; border-radius:8px; " +
                        "background:rgba(255,0,255,0.1); color:#0ff; font-weight:bold; " +
                        "box-shadow:0 0 10px #ff00ff;'>" +
                        "<span style='color:#ff0; text-shadow:0 0 5px #ff0;'>" + message.sender + ":</span> " +
                        message.content + "</p>";
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>
